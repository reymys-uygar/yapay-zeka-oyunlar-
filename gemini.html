
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>AETHER DRIFT: JANDIX V4</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Rajdhani:wght@500;700&family=Syncopate:wght@700&display=swap');

    :root {
        --bg-color: #050509;
        --primary: #00f0ff;
        --secondary: #ff0055;
        --gold: #f1c40f;
        --jandix: #2ecc71;
        --ui-font: 'Rajdhani', sans-serif;
        --title-font: 'Syncopate', sans-serif;
    }

    body, html {
        margin: 0; padding: 0;
        width: 100%; height: 100%;
        overflow: hidden;
        background-color: var(--bg-color);
        color: white;
        font-family: var(--ui-font);
        touch-action: none;
        user-select: none;
        -webkit-user-select: none;
        transition: background-color 3s ease;
    }

    /* BIOMES */
    body.biome-void { background-color: #1a0525; }
    body.biome-inferno { background-color: #2b0505; }
    body.biome-cyber { background-color: #00151a; }

    /* SPLASH */
    #splash {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #000; z-index: 9999;
        display: flex; justify-content: center; align-items: center;
        transition: opacity 0.8s;
    }
    .splash-text {
        font-family: var(--title-font);
        font-size: 2.5rem; color: var(--jandix);
        text-shadow: 0 0 30px var(--jandix);
        letter-spacing: 5px;
        animation: pulseText 2s infinite;
        text-align: center;
    }

    canvas { display: block; }

    /* UI */
    #ui-layer {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; padding: 20px; box-sizing: border-box; z-index: 10;
    }
    
    .hud { display: flex; justify-content: space-between; align-items: flex-start; }
    .score-wrap { text-align: left; }
    .big-score { font-family: var(--title-font); font-size: 2.2rem; font-weight: bold; text-shadow: 0 0 15px var(--primary); }
    .sub-text { font-size: 0.9rem; color: #888; margin-top: 5px; font-weight: bold; }
    .coin-disp { color: var(--gold); margin-top: 5px; font-size: 1.2rem; text-shadow: 0 0 10px var(--gold); }

    /* SCREENS */
    .screen {
        position: absolute; top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(12, 12, 20, 0.98);
        border: 1px solid rgba(255,255,255,0.1);
        box-shadow: 0 0 60px rgba(0,0,0,0.95);
        padding: 25px; width: 90%; max-width: 400px;
        text-align: center; border-radius: 20px;
        pointer-events: auto;
        transition: opacity 0.3s;
        display: flex; flex-direction: column; gap: 15px;
        z-index: 100;
        backdrop-filter: blur(10px);
    }
    .hidden { opacity: 0; pointer-events: none; transform: translate(-50%, -60%); display: none !important; }

    h1 { margin: 0; color: var(--primary); font-family: var(--title-font); font-size: 2rem; text-shadow: 0 0 20px rgba(0,240,255,0.4); }
    h2 { margin: 0; color: var(--secondary); font-family: 'Press Start 2P', cursive; font-size: 1.5rem; line-height: 1.5; }

    .btn {
        background: linear-gradient(90deg, var(--primary), #0088ff);
        border: none; color: #000; padding: 18px;
        font-family: var(--title-font); font-weight: bold; font-size: 1.1rem;
        cursor: pointer; clip-path: polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px);
        text-transform: uppercase; letter-spacing: 2px;
    }
    .btn:active { transform: scale(0.96); filter: brightness(1.2); }
    .btn-sec { background: transparent; color: white; border: 1px solid #444; }
    .btn-share { background: var(--jandix); color: #000; }

    /* GARAGE */
    .garage-grid { 
        display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 10px 0; 
        max-height: 300px; overflow-y: auto; padding-right: 5px;
    }
    .ship-card { 
        background: rgba(255,255,255,0.03); border: 1px solid #333; padding: 15px; 
        border-radius: 10px; cursor: pointer; transition: 0.2s;
        display: flex; flex-direction: column; align-items: center;
    }
    .ship-card.selected { border-color: var(--jandix); background: rgba(46, 204, 113, 0.05); box-shadow: inset 0 0 20px rgba(46,204,113,0.1); }
    .ship-icon { width: 40px; height: 40px; margin-bottom: 10px; display: block; border-radius: 50%; }
    .ship-name { font-weight: 700; font-size: 0.9rem; margin-bottom: 4px; color: #eee; }
    .cost { font-size: 0.75rem; color: var(--gold); font-weight: bold; background: rgba(241, 196, 15, 0.1); padding: 2px 6px; border-radius: 4px;}

    @keyframes pulseText { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .hyper-mode canvas { filter: invert(1) hue-rotate(180deg); }
    .danger-text { color: var(--secondary); font-size: 0.8rem; letter-spacing: 2px; animation: pulseText 0.5s infinite; }
</style>
</head>
<body>

<div id="splash"><div class="splash-text">JANDIX<br>GAMES</div></div>

<canvas id="canvas"></canvas>

<div id="ui-layer">
    <div class="hud">
        <div class="score-wrap">
            <div id="scoreVal" class="big-score">0</div>
            <div id="comboText" style="color:var(--secondary); opacity:0; font-weight:800; font-style:italic;">COMBO x1</div>
        </div>
        <div class="score-wrap" style="text-align:right;">
            <div id="coinVal" class="coin-disp"><span>ðŸª™</span> <span id="coinNum">0</span></div>
            <div id="bestVal" class="sub-text">BEST: 0</div>
            <div id="speedWarning" class="danger-text" style="opacity:0; margin-top:5px;">SPEED UP!</div>
        </div>
    </div>
</div>

<div id="menuScreen" class="screen hidden">
    <h1>AETHER DRIFT</h1>
    <p style="color:#aaa; font-size:0.9rem; letter-spacing: 1px;">TAP TO LAUNCH</p>
    <button class="btn" onclick="startGame()">MISSION START</button>
    <button class="btn btn-sec" onclick="openGarage()">GARAGE / SKINS</button>
</div>

<div id="garageScreen" class="screen hidden">
    <h1>HANGAR</h1>
    <p style="font-size:1rem; color:gold; font-weight:bold;">BALANCE: <span id="garageCoins">0</span></p>
    <div class="garage-grid" id="shipGrid"></div>
    <button class="btn btn-sec" onclick="closeGarage()">BACK</button>
</div>

<div id="overScreen" class="screen hidden">
    <h2>SYSTEM<br>FAILURE</h2>
    <p>ALTITUDE: <span id="finalScore" style="color:var(--primary)">0</span>m</p>
    <p>EARNED: <span id="finalCoins" style="color:gold">0</span> Coins</p>
    <button class="btn" onclick="startGame()">RETRY</button>
    <button class="btn btn-share" onclick="shareScore()">CHALLENGE FRIENDS</button>
    <button class="btn btn-sec" onclick="showMenu()">MENU</button>
</div>

<script>
// --- CONFIG & SHIPS ---
const CONFIG = {
    baseWidth: 400,
    ships: [
        { id: 'starter', name: 'Scout Mark I', cost: 0, color: '#00f0ff', speed: 1.0, lives: 1, type: 'basic' },
        { id: 'tank', name: 'Heavy Titan', cost: 250, color: '#e74c3c', speed: 0.85, lives: 2, type: 'tank' },
        { id: 'neon', name: 'Neon Prime', cost: 600, color: '#2ecc71', speed: 1.1, lives: 1, type: 'glow' },
        { id: 'phantom', name: 'Phantom X', cost: 1200, color: '#ffffff', speed: 1.2, lives: 1, type: 'ghost' },
        { id: 'glitch', name: 'Cyber Glitch', cost: 2500, color: '#bd00ff', speed: 1.3, lives: 1, type: 'glitch' },
        { id: 'gold', name: 'Midas Touch', cost: 5000, color: '#f1c40f', speed: 1.0, lives: 3, type: 'gold' }
    ]
};

let state = {
    score: 0,
    highScore: parseInt(localStorage.getItem('jx_best') || 0),
    coins: parseInt(localStorage.getItem('jx_coins') || 0),
    inventory: JSON.parse(localStorage.getItem('jx_inv') || '["starter"]'),
    equipped: localStorage.getItem('jx_equip') || 'starter',
    active: false,
    combo: 0,
    hyperMode: false,
    timeScale: 1,
    cameraY: 0,
    shake: 0,
    difficulty: 0
};

const AudioEngine = {
    ctx: null,
    init() { if(!this.ctx) this.ctx = new (window.AudioContext||window.webkitAudioContext)(); },
    play(freq, type, dur, vol=0.1) {
        if(!this.ctx) return;
        const o = this.ctx.createOscillator();
        const g = this.ctx.createGain();
        o.type = type; o.frequency.setValueAtTime(freq, this.ctx.currentTime);
        g.gain.setValueAtTime(vol, this.ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime+dur);
        o.connect(g); g.connect(this.ctx.destination);
        o.start(); o.stop(this.ctx.currentTime+dur);
    },
    crash() { this.play(100, 'sawtooth', 0.5, 0.3); },
    collect() { this.play(600 + (state.combo*100), 'sine', 0.1, 0.1); },
    coin() { this.play(1200, 'square', 0.1, 0.1); },
    launch() { this.play(200, 'triangle', 0.2, 0.1); }
};

const cvs = document.getElementById('canvas');
const ctx = cvs.getContext('2d');
let scale = 1, W, H;

function resize() {
    W = cvs.width = window.innerWidth;
    H = cvs.height = window.innerHeight;
    scale = Math.min(W / CONFIG.baseWidth, 1.2); 
}
window.addEventListener('resize', resize);
resize();

class Node {
    constructor(y, isStart=false) {
        this.y = y;
        this.x = (Math.random() * (W - 100*scale)) + 50*scale;
        if(isStart) this.x = W/2;
        this.r = (isStart ? 30 : 22 + Math.random() * 15) * scale; // TOPLAR DAHA BÃœYÃœK (KOLAYLIK)
        this.visited = isStart;
        this.pulse = 0;
        this.type = 'normal';
        if(!isStart && Math.random() < 0.1) this.type = 'gold';
    }
    draw() {
        this.pulse += 0.05;
        let color = '#00f0ff';
        if(state.score > 5000) color = '#ff3333';
        else if(state.score > 2000) color = '#bd00ff';
        else if(state.score > 1000) color = '#00ffaa';
        if(this.type === 'gold') color = '#f1c40f';

        ctx.strokeStyle = color;
        ctx.shadowBlur = 15; ctx.shadowColor = color;
        ctx.lineWidth = 2;
        
        ctx.beginPath(); ctx.arc(this.x, this.y - state.cameraY, this.r, 0, Math.PI*2); ctx.stroke();
        
        ctx.beginPath(); ctx.arc(this.x, this.y - state.cameraY, this.r * 0.3, 0, Math.PI*2);
        ctx.fillStyle = this.visited ? '#fff' : color;
        ctx.fill();
        ctx.shadowBlur = 0;
    }
}

class Player {
    constructor(node) {
        this.node = node;
        this.ship = CONFIG.ships.find(s => s.id === state.equipped) || CONFIG.ships[0];
        this.lives = this.ship.lives;
        this.angle = 0;
        this.dist = 85 * scale;
        this.x = node.x; this.y = node.y;
        this.state = 'orbit';
        this.vel = {x:0, y:0};
        this.trail = [];
    }
    update() {
        if(state.active) this.trail.push({x:this.x, y:this.y, alpha:1});
        if(this.trail.length > 15) this.trail.shift();

        if (this.state === 'orbit') {
            // BAÅžLANGIÃ‡ HIZI DÃœÅžÃœRÃœLDÃœ (0.05 -> 0.04)
            let rotationSpeed = (0.04 + (state.difficulty * 0.005)) * this.ship.speed;
            this.angle += rotationSpeed * state.timeScale;
            this.x = this.node.x + Math.cos(this.angle) * this.dist;
            this.y = this.node.y + Math.sin(this.angle) * this.dist;
        } else {
            this.x += this.vel.x * state.timeScale;
            this.y += this.vel.y * state.timeScale;
            // YERÃ‡EKÄ°MÄ° ARTIRILDI (0.05 -> 0.15) -> "TAÅž GÄ°BÄ° DÃœÅžME" FIX
            this.vel.y += 0.15 * scale * state.timeScale; 
        }
    }
    draw() {
        this.trail.forEach(t => {
            t.alpha -= 0.08;
            ctx.fillStyle = `rgba(255, 255, 255, ${Math.max(0,t.alpha)})`;
            ctx.fillRect(t.x, t.y - state.cameraY, 3*scale, 3*scale);
        });

        ctx.save();
        ctx.translate(this.x, this.y - state.cameraY);
        ctx.rotate(this.state === 'drift' ? Math.atan2(this.vel.y, this.vel.x) : this.angle + Math.PI/2);
        
        ctx.fillStyle = this.ship.color;
        if(this.ship.type === 'glow') { ctx.shadowBlur = 25; ctx.shadowColor = this.ship.color; }
        else { ctx.shadowBlur = 10; ctx.shadowColor = this.ship.color; }
        
        ctx.beginPath();
        ctx.moveTo(12*scale, 0);
        ctx.lineTo(-10*scale, 8*scale);
        ctx.lineTo(-10*scale, -8*scale);
        ctx.fill();
        ctx.restore();
    }
}

let nodes = [], player;

function startGame() {
    AudioEngine.init();
    if(AudioEngine.ctx && AudioEngine.ctx.state === 'suspended') AudioEngine.ctx.resume();
    
    state.active = true;
    state.score = 0;
    state.combo = 0;
    state.hyperMode = false;
    state.timeScale = 1;
    state.shake = 0;
    state.cameraY = 0;
    state.difficulty = 0;
    
    document.body.className = '';
    
    nodes = [new Node(H - 250, true)];
    spawnNodes();
    player = new Player(nodes[0]);
    
    document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
    updateHUD();
    loop();
}

function spawnNodes() {
    while (nodes[nodes.length-1].y > state.cameraY - H) { 
        const last = nodes[nodes.length-1];
        // TOPLAR DAHA YAKIN (140 + Difficulty)
        const gap = (140 + (state.difficulty * 2) + Math.random() * 80) * scale;
        nodes.push(new Node(last.y - gap));
    }
    if(nodes.length > 20 && nodes[0].y > state.cameraY + H + 200) nodes.shift();
}

function gameOver() {
    state.active = false;
    AudioEngine.crash();
    
    const earned = Math.floor(state.score / 10);
    state.coins += earned;
    if(state.score > state.highScore) {
        state.highScore = state.score;
        localStorage.setItem('jx_best', state.highScore);
    }
    localStorage.setItem('jx_coins', state.coins);
    
    document.getElementById('finalScore').innerText = Math.floor(state.score);
    document.getElementById('finalCoins').innerText = earned;
    document.getElementById('overScreen').classList.remove('hidden');
    document.body.classList.remove('hyper-mode');
}

function loop() {
    if(!state.active) return;
    
    if(state.difficulty < 10) state.difficulty = Math.min(10, state.score / 500); 

    player.update();
    const targetY = player.y - H * 0.65;
    state.cameraY += (targetY - state.cameraY) * 0.1;
    
    if(state.score > 5000) document.body.className = 'biome-inferno';
    else if(state.score > 2000) document.body.className = 'biome-void';
    else if(state.score > 1000) document.body.className = 'biome-cyber';

    const warn = document.getElementById('speedWarning');
    if(state.difficulty > 8) warn.style.opacity = 1;
    
    let sx=0, sy=0;
    if(state.shake > 0) {
        sx = (Math.random()-0.5)*state.shake;
        sy = (Math.random()-0.5)*state.shake;
        state.shake *= 0.9;
        if(state.shake<1) state.shake=0;
    }
    
    if(player.state === 'drift') {
        let hit = false;
        nodes.forEach(node => {
            const dx = player.x - node.x;
            const dy = player.y - node.y;
            const dist = Math.sqrt(dx*dx + dy*dy);
            
            // HITBOX ARTTI: +35 tolerans (MÄ±knatÄ±s etkisi)
            if (dist < node.r + 35*scale && node !== player.node) {
                hit = true;
                player.state = 'orbit';
                player.node = node;
                player.angle = Math.atan2(dy, dx);
                
                if(!node.visited) {
                    node.visited = true;
                    state.combo++;
                    if(node.type === 'gold') { state.coins += 50; AudioEngine.coin(); }
                    state.score += (100 + (state.combo * 10));
                    AudioEngine.collect();
                    if(state.combo > 5 && !state.hyperMode) {
                        state.hyperMode = true;
                        document.body.classList.add('hyper-mode');
                        state.shake = 10;
                    }
                }
                spawnNodes(); 
            }
        });
        
        if(!hit && (player.x < -20 || player.x > W+20 || player.y - state.cameraY > H + 100)) {
            player.lives--;
            if(player.lives <= 0) gameOver();
            else {
                player.vel.y = -15 * scale;
                state.shake = 20;
                AudioEngine.crash();
            }
        }
    }
    
    ctx.clearRect(0,0,W,H);
    ctx.save();
    ctx.translate(sx, sy);
    nodes.forEach(n => { if(n.y - state.cameraY < H+100 && n.y - state.cameraY > -H) n.draw(); });
    player.draw();
    ctx.restore();
    updateHUD();
    requestAnimationFrame(loop);
}

function updateHUD() {
    document.getElementById('scoreVal').innerText = Math.floor(state.score);
    document.getElementById('coinNum').innerText = state.coins;
    document.getElementById('bestVal').innerText = "BEST: " + state.highScore;
    const comboEl = document.getElementById('comboText');
    if(state.combo > 1) {
        comboEl.innerText = "COMBO x" + state.combo;
        comboEl.style.opacity = 1;
        comboEl.style.transform = `scale(${1 + state.combo*0.1})`;
    } else { comboEl.style.opacity = 0; }
}

function handleInput(e) {
    if(e.target.tagName === 'BUTTON' || e.target.closest('.ship-card') || e.target.closest('.screen')) return;
    if(e.type === 'touchstart') e.preventDefault();
    if(!state.active) return;
    
    if(player.state === 'orbit') {
        player.state = 'drift';
        // FIRLATMA GÃœCÃœ (YerÃ§ekimi artÄ±nca burayÄ± da artÄ±rdÄ±k)
        const speed = (16 + (state.difficulty * 0.5)) * player.ship.speed * scale;
        player.vel.x = -Math.sin(player.angle) * speed;
        player.vel.y = Math.cos(player.angle) * speed;
        AudioEngine.launch();
    }
}
window.addEventListener('touchstart', handleInput, {passive: false});
window.addEventListener('mousedown', handleInput);

function showMenu() {
    document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
    document.getElementById('menuScreen').classList.remove('hidden');
    document.body.classList.remove('hyper-mode');
}

function openGarage() {
    document.getElementById('menuScreen').classList.add('hidden');
    document.getElementById('garageScreen').classList.remove('hidden');
    document.getElementById('garageCoins').innerText = state.coins;
    const grid = document.getElementById('shipGrid');
    grid.innerHTML = '';
    CONFIG.ships.forEach(ship => {
        const owned = state.inventory.includes(ship.id);
        const div = document.createElement('div');
        div.className = `ship-card ${state.equipped === ship.id ? 'selected' : ''}`;
        div.innerHTML = `
            <div class="ship-icon" style="background:${ship.color}; box-shadow: 0 0 10px ${ship.color}"></div>
            <div class="ship-name">${ship.name}</div>
            ${owned ? '<div class="owned-badge">OWNED</div>' : `<div class="cost">${ship.cost} ðŸª™</div>`}
        `;
        div.onclick = function() {
            if(owned) {
                state.equipped = ship.id;
                localStorage.setItem('jx_equip', ship.id);
                openGarage(); 
            } else if(state.coins >= ship.cost) {
                state.coins -= ship.cost;
                state.inventory.push(ship.id);
                localStorage.setItem('jx_coins', state.coins);
                localStorage.setItem('jx_inv', JSON.stringify(state.inventory));
                openGarage(); 
            } else {
                this.style.borderColor = 'red';
                setTimeout(() => this.style.borderColor = '#333', 300);
            }
        };
        grid.appendChild(div);
    });
}

function closeGarage() {
    document.getElementById('garageScreen').classList.add('hidden');
    document.getElementById('menuScreen').classList.remove('hidden');
}

function shareScore() {
    const text = `I reached ${Math.floor(state.score)}m in Aether Drift! Beat me? #JandixGames`;
    if(navigator.share) navigator.share({ title: 'Aether Drift', text: text, url: window.location.href });
    else alert("Score copied!");
}

window.onload = () => {
    setTimeout(() => {
        const splash = document.getElementById('splash');
        splash.style.opacity = 0;
        setTimeout(() => {
            splash.style.display = 'none';
            showMenu();
        }, 800);
    }, 2000);
};
</script>
</body>
</html>
